---
lang: "en"
title: "Local School Demographics"
author: "by Michele Claibourn, Nina Schoonover, Elizabeth Mitchell, Asha Muralidharan, & Chris Hu"
date: "November 2023"
output:
  html_document:
    template: school-composition-template.html
    css: styles.css
---

```{css, echo=FALSE}
.main-container.container-fluid {
max-width: 1200px;
  margin-left: auto;
  margin-right: auto;
  padding: 0 4.167%;
}
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

library(tidyverse)
library(tidycensus)
library(reactable)
library(htmltools)
library(sf)
library(sp)
library(tigris)
options(tigris_use_cache = TRUE)
library(leaflet)
library(leaflegend)
library(readxl)

schoolmapdata2023 <- read_excel("schoolmapdata_23.xlsx")

# List of desired localities by FIPS
ccode <- read_csv("county_codes.csv")
region <- ccode$code # list of desired counties
# - 003 Albemarle County  
# - 015 Augusta County
# - 029 Buckingham County
# - 540 Charlottesville
# - 065 Fluvanna County
# - 079 Greene County 
# - 109 Louisa County
# - 113 Madison County
# - 125 Nelson County
# - 137 Orange County
# - 790 Staunton
# - 820 Waynesboro

counties_geo <- counties(state = 'VA', year = 2022) # from tigris
counties_geo <- counties_geo %>% subset(COUNTYFP %in% region)

counties_geo <- st_transform(counties_geo, 4326)
# below variables for leaflet map boundary settings
bbox <- st_bbox(counties_geo) %>% as.vector()

```

## Map


```{r}
districtpalette <- colorFactor(
  palette= c("#b45248","#50a9a6","#cab2d6","#2f7e9f","#004600","#360021","#002671", "#70B13D", "#E09056", "#0000CA"),
  domain = c("Albemarle County", "Augusta County", "Buckingham County", "Charlottesville City", "Fluvanna County", "Greene County","Louisa County", "Nelson County", "Staunton City", "Waynesboro City"))

##### add madison and orange to the list above

map <- leaflet() %>% 
  leaflet(width = "100%", height = "700px") %>% 
  addProviderTiles("CartoDB.Voyager") %>% 
  fitBounds(bbox[1], bbox[2], bbox[3], bbox[4]) %>%
  addMapPane('countyBoundaries', zIndex = 410) %>%
  addPolygons(data= counties_geo, color = "#969997",
                    fill = FALSE,
                    weight = 2,
                    group = 'countyBoundaries',
                    options = pathOptions(pane = 'countyBoundaries')) %>%
  addCircleMarkers(data = schoolmapdata2023,
                   lng = ~schoolmapdata2023$Longitude, 
                   lat = ~schoolmapdata2023$Latitude,
                   radius = ~schoolmapdata2023$Total_Count*0.009, 
                   color = ~districtpalette(schoolmapdata2023$District)
                    )

map %>% addLegendFactor(pal = districtpalette,
                shape = "rect",
                orientation = "vertical",
                values = schoolmapdata2023$District,
                naLabel = "",
                title = "",
                opacity = 0.8,
                width = 20,
                height = 10, position = "bottomleft")

```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

library(tidyverse)
library(reactable)

load("2024demographictables.Rdata")
students2024 <- students2024 %>% 
  separate(division, c("division", "locality")) %>% 
  select(-c(year, locality)) %>% 
  relocate(c(count_adv, count_disadv), .before = perc_aian)
```
## Demographic Tables {.tabset .tabset-pills}
The tables below provide the demographic composition of the following districts: Albemarle County Public Schools, Augusta County Public Schools, Buckingham County Public Schools, Charlottesville City Schools, Fluvanna County Public Schools, Greene County Public Schools, Louisa County Public Schools, Madison County Public Schools, Orange County Public Schools, Staunton City Schools, and Waynesboro City Schools.

These numbers reflect Fall Membership numbers provided by the Virginia Department of Education's [Fall Membership Build-a-Table site](https://p1pe.doe.virginia.gov/apex_captcha/home.do?apexTypeId=304).

According to VDOE documentation

* Race or Ethnicity captures "the racial category that most closely reflects the studentâ€™s recognition of his or her community or with which the student identifies"

* Economic status "identifies students as economically disadvantaged if they meet any one of the following: 1) is eligible for Free/Reduced Meals, or 2) receives TANF, or 3) is eligible for Medicaid, or 4) identified as either Migrant or experiencing Homelessness."

* English Learners are students "1) not born in the United States or whose native language is a language other than English; 2) who come from an environment where a language other than English has had a significant impact on the individual's level of English language proficiency; 3) who are migratory, whose native language is a language other than English, and who comes from an environment where a language other than English is dominant; 4) whose first language is other than English and who is in a special program for learning English, or 5) whose difficulties in speaking, reading, writing, or understanding the English language may be sufficient to deny the individual the ability to meet the challenging State academic standards, successfully achieve in classrooms where the language of instruction is English, or partipate fully in society"


Scroll further right to see the percent of a school's student body by Race, the number and percent of students identified as Economically Disadvantaged, and the number and percent of students identified as English Learners. The tables can be sorted by any column by clicking on the up/down arrow next to the column name.

### 2023-2024 Academic Year

```{r}
reactable(students2023,
          columns = list(
             division = colDef(name = "Division",
                                style = list(background = "#F4E3D3FF")),
            school = colDef(name = "School",
                                style = list(background = "#F4E3D3FF")),
            students = colDef(name = "Students",
                                style = list(background = "#F4E3D3FF")),
            count_aian = colDef(name = "Am. Indian AK Native",
                                style = list(background = "#C5CCD2")),
            count_asian = colDef(name = "Asian",
                                style = list(background = "#C5CCD2")),
            count_black = colDef(name = "Black",
                                style = list(background = "#C5CCD2")),
            count_latinx = colDef(name = "Hispanic",
                                style = list(background = "#C5CCD2")),
            count_nhpi = colDef(name = "Native HI Pacific Islander",
                                style = list(background = "#C5CCD2")),
            count_white = colDef(name = "White",
                                style = list(background = "#C5CCD2")),
            count_adv = colDef(name = "Advantaged",
                                style = list(background = "#B4D6DB")),
            count_disadv = colDef(name = "Disadvantaged",
                                style = list(background = "#B4D6DB")),
            perc_aian = colDef(name = "Am. Indian AK Native",
                               style = list(background = "#ADB7C0FF"),
                               format = colFormat(suffix = "%")),
            perc_asian = colDef(name = "Asian",
                                style = list(background = "#ADB7C0FF"),
                               format = colFormat(suffix = "%")),
            perc_black = colDef(name = "Black",
                                style = list(background = "#ADB7C0FF"),
                               format = colFormat(suffix = "%")),
            perc_latinx = colDef(name = "Hispanic",
                                style = list(background = "#ADB7C0FF"),
                               format = colFormat(suffix = "%")),
            perc_nhpi = colDef(name = "Native HI Pacific Islander",
                                style = list(background = "#ADB7C0FF"),
                               format = colFormat(suffix = "%")),
            perc_white = colDef(name = "White",
                                style = list(background = "#ADB7C0FF"),
                               format = colFormat(suffix = "%")),
            perc_adv = colDef(name = "Advantaged",
                                style = list(background = "#94C5CCFF"),
                               format = colFormat(suffix = "%")),
            perc_disadv = colDef(name = "Disadvantaged",
                                style = list(background = "#94C5CCFF"),
                               format = colFormat(suffix = "%"))),
          columnGroups = list(
            colGroup(name = "Counts by Racial/Ethnic Identity", 
                     columns = c("count_aian", "count_asian", "count_black", "count_latinx",
                                 "count_nhpi", "count_white")),
            colGroup(name = "Counts by Economic Status", 
                     columns = c("count_adv", "count_disadv")),
            colGroup(name = "Percents by Racial/Ethnic Identity", 
                     columns = c("perc_aian", "perc_asian", "perc_black", "perc_latinx",
                                 "perc_nhpi", "perc_white")),
            colGroup(name = "Percents by Economic Status", 
                     columns = c("perc_adv", "perc_disadv"))
          ),
          showSortable = TRUE, defaultPageSize = 12)
```

